<!DOCTYPE html>
<html>
<head>
    <title>Hammer Game!</title>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <link rel="manifest" href="/manifest.json">
    <script>
        if ('serviceWorker' in navigator) {
    window.addEventListener('load', function () {
        navigator.serviceWorker.register('/sw.js', {scope: '/'})
            .then(function (registration) {

                // 注册成功
                console.log('ServiceWorker registration successful with scope: ', registration.scope);
            })
            .catch(function (err) {

                // 注册失败:(
                console.log('ServiceWorker registration failed: ', err);
            });
    });
}
        let deferredPrompt;
const addBtn = document.querySelector('.add-button');
addBtn.style.display = 'none';

window.addEventListener('beforeinstallprompt', (e) => {
  // Prevent Chrome 67 and earlier from automatically showing the prompt
  e.preventDefault();
  // Stash the event so it can be triggered later.
  deferredPrompt = e;
  // Update UI to notify the user they can add to home screen
  addBtn.style.display = 'block';

  addBtn.addEventListener('click', (e) => {
    // hide our user interface that shows our A2HS button
    addBtn.style.display = 'none';
    // Show the prompt
    deferredPrompt.prompt();
    // Wait for the user to respond to the prompt
    deferredPrompt.userChoice.then((choiceResult) => {
        if (choiceResult.outcome === 'accepted') {
          console.log('User accepted the A2HS prompt');
        } else {
          console.log('User dismissed the A2HS prompt');
        }
        deferredPrompt = null;
      });
  });
});
        
    var timeRemaining = 3;          // Amount of time remaining for the countDown

    var timeToShowMonster = 2000;   // Amount of time to show the monster
    var timeToHideMonster = 2000;   // Amount of time to hide the monster

    var hideMonsterTimeout;         // Timeout id for hiding the monster

    var life = 3;                   // The player's life

    function hideMonster() {
        // Change the life and the colour of the holes
        if (life == 3){life-=1; $(".hole").css("border-color", "yellow");}
        else if (life == 2){life-=1; $(".hole").css("border-color", "red");}
        // If the game is over show the game over screen
        else if (life == 1){life-=1; $("#gameOver").slideDown(400);}
        // Hide the monster
        $("#monster").hide();

        // Show the monster later again
        hideMonsterTimeout = setTimeout(showMonster, timeToShowMonster);
    }

    function showMonster() {
        // Find the target div randomly and move the monster
        // to that div
        var random_number = Math.random() * 9;
        random_number = Math.floor(random_number);
        var random_div = $(".hole").eq(random_number);
        $("#monster").appendTo(random_div);
        // Show the monster
        $("#monster").show();

        // Hide the monster later
        hideMonsterTimeout = setTimeout(hideMonster, timeToHideMonster);
    }

    function startGame() {
        // Hide the countDown timer 
        $("#countDown").slideUp(400);
        // Show the monster the first time
        hideMonsterTimeout = setTimeout(showMonster, timeToShowMonster);
        // Set up the click handler of the monster
        $("#monster").on("click", function(){
        // - Clear the previous timeout
        clearTimeout(hideMonsterTimeout);
        // - Hide the monster
        $("#monster").hide();
        // - Adjust the monster time
        timeToShowMonster = timeToShowMonster - 100;
        timeToHideMonster = timeToHideMonster - 100;
        // - Show the monster later again
        hideMonsterTimeout = setTimeout(showMonster, timeToShowMonster);
        });
    }

    function countDown() {
        // Decrease the remaining time
        timeRemaining = timeRemaining -1;
        if (timeRemaining == 0) {
            document.getElementById("countDown").textContent = "Start"; 
            setTimeout(startGame, 1000);  // otherwise, start the game when the time is up
            }
        else {document.getElementById("countDown").textContent = timeRemaining;}
        // Continue the countDown if there is still time;
        if (timeRemaining > 0) setTimeout(countDown, 1000);
    }

    $(document).ready(function() {
        // Start the countDown screen
        setTimeout(countDown, 1000);
    });
    </script>

    <!-- This is the font returned from Google font -->
    <link href="https://fonts.googleapis.com/css?family=Gloria+Hallelujah" rel="stylesheet">

    <style>
    /* This is the style of the body element */
    body {
        font-family: 'Gloria Hallelujah', cursive;
        margin: 0;
        padding: 0;
        background: white url(clown.png);
    }

    /* Set the common style for the countDown and gameOver divs */
    #countDown, #gameOver {
        position: absolute;
        left: 0;
        top: 0;
        width: 100vw;
        height: 100vh;
        padding: 0;
        text-align: center;
        font-size: 20vh;
        line-height: 100vh;
        background-color: rgba(0, 0, 0, 0.8);
    }

    /* - Set the properties for the countDown div */
    #countDown {
        color: orange;
    }

    /* - Set the properties for the gameOver div */
    #gameOver {
        color: maroon;
        display: none;
    }

    /* Set the style of the game area */
    #game-area {
        width: 90vmin;
        height: 90vmin;
        margin: 5vmin auto;
    }

    /* - Set the style of the holes */
    .hole {
        float: left;
        width: 25vmin;
        height: 25vmin;
        margin: 2.5vmin 2.5vmin;
        box-sizing: border-box;
        border: 1vmin solid green;
        border-radius: 15px;
        background: black;
    }

    /* - Set the style of the monster image */
    #monster {
        display: none;
        width: 100%;
    }
    </style>
</head>
<body>
    <button class="add-button">Add to home screen</button>
    <!-- This div contains all holes -->
    <div id="game-area">
        <div class="hole">
            <!-- This is the monster -->
            <img id="monster" src="nomore.png" alt="Nomore monster">
        </div>
        <div class="hole"></div>
        <div class="hole"></div>
        <div class="hole"></div>
        <div class="hole"></div>
        <div class="hole"></div>
        <div class="hole"></div>
        <div class="hole"></div>
        <div class="hole"></div>
    </div>

    <!-- The countDown screen -->
    <div id="countDown">3</div>

    <!-- The gameOver screen -->
    <div id="gameOver">Game Over</div>
</body>
</html>
